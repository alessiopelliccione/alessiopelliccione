name: Update Contributions Dashboard

on:
  schedule:
    - cron: '0 8 * * *' # Runs every day at 8:00 AM UTC
  workflow_dispatch: # Allows manual trigger from Actions tab

jobs:
  update-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write # Grants write permission to the default GITHUB_TOKEN
    steps:
      # 1. CHECKOUT: Get the repository code (including the script)
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. SETUP: Install Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. INSTALL: Install the necessary dependencies
      - name: Install dependencies
        run: npm install @octokit/rest

      # 4. EXECUTE: Run the external script
      - name: Generate Dashboards
        run: node .github/scripts/update-dashboards.js
        env:
          # Personal Access Token for reading public PRs from other repos
          SEARCH_TOKEN: ${{ secrets.CONTRIBUTION_UPDATE_TOKEN }}
          # Default GITHUB_TOKEN for updating issues in this repo
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # Repository information
          GITHUB_REPOSITORY: ${{ github.repository }}
